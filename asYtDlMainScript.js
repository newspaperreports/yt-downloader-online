// üîΩ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶¨‡¶æ‡¶ü‡¶®‡ßá‡¶∞ ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶≤‡¶æ‡¶∞
document.getElementById('download-btn').addEventListener('click', async function () {
    // üéØ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶•‡ßá‡¶ï‡ßá ‡¶á‡¶â‡¶ü‡¶ø‡¶â‡¶¨ URL ‡¶®‡ßá‡ßü‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
    const url = document.getElementById('youtube-url').value;

    // ‚ö†Ô∏è ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶´‡¶æ‡¶Å‡¶ï‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡ßç‡¶ü ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶¨‡ßá
    if (!url) {
        alert('Please enter a YouTube URL');
        return;
    }

    // üîç ‡¶á‡¶â‡¶ü‡¶ø‡¶â‡¶¨ ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ID ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá (URL ‡¶•‡ßá‡¶ï‡ßá ‡ßß‡ßß ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá‡¶∞ ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶Ü‡¶á‡¶°‡¶ø ‡¶ñ‡ßã‡¶Å‡¶ú‡¶æ)
    const videoIdMatch = url.match(/(?:v=|\/)([a-zA-Z0-9_-]{11})/);
    if (!videoIdMatch) {
        alert('Invalid YouTube URL');
        return;
    }
    const videoId = videoIdMatch[1];

    // ‚úÖ ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞‡¶ü‡¶ø ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá
    document.getElementById('result-container').style.display = 'block';

    // ‚è≥ ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶ì ‡¶™‡ßç‡¶≤‡ßá‡¶∏‡¶π‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶ú ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá
    document.getElementById('video-title').innerText = 'Loading...';
    document.getElementById('video-description').innerText = 'Fetching video details...';

    // üîî ‡¶è‡¶ñ‡¶æ‡¶®‡ßá placeholder image URL ‡¶†‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá‡¶õ‡¶ø, ‡¶Ø‡¶æ‡¶§‡ßá DNS ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶®‡¶æ ‡¶π‡ßü
    document.getElementById('video-thumbnail').src = 'https://dummyimage.com/320x180/cccccc/000000.png&text=Loading';

    // üîÑ ‡¶™‡ßÅ‡¶∞‡¶æ‡¶§‡¶® ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶á‡¶®‡¶´‡ßã ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
    document.getElementById('video-views').innerText = '';
    document.getElementById('video-duration').innerText = '';
    document.getElementById('video-publish-date').innerText = '';

    // üîÑ API ‡¶ï‡¶≤ ‡¶ï‡¶∞‡ßá ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶§‡¶•‡ßç‡¶Ø ‡¶Ü‡¶®‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
    try {
        const response = await fetch(`https://ytstream-download-youtube-videos.p.rapidapi.com/dl?id=${videoId}`, {
            method: 'GET',
            headers: {
                'X-RapidAPI-Key': 'd189877d33msh319d00e47775cf0p1bc5d9jsn2eb2609c3d60', // ‚ö†Ô∏è ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ API ‡¶ï‡ßÄ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶Ü‡¶õ‡ßá
                'X-RapidAPI-Host': 'ytstream-download-youtube-videos.p.rapidapi.com'
            }
        });

        // ‚ùå ‡¶Ø‡¶¶‡¶ø ‡¶∞‡ßá‡¶∏‡¶™‡¶®‡ßç‡¶∏ ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡¶æ ‡¶π‡ßü, ‡¶è‡¶∞‡¶∞ ‡¶•‡ßç‡¶∞‡ßã ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá
        if (!response.ok) throw new Error('API request failed');

        // ‚úÖ API ‡¶•‡ßá‡¶ï‡ßá ‡¶™‡¶æ‡¶ì‡ßü‡¶æ JSON ‡¶°‡ßá‡¶ü‡¶æ ‡¶®‡ßá‡ßü‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
        const data = await response.json();

        // console.log(data); // ‚úÖ ‡¶°‡ßá‡¶≠‡ßá‡¶≤‡¶™‡¶æ‡¶∞ ‡¶ï‡¶®‡¶∏‡ßã‡¶≤‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá

        // üì∫ UI ‡¶§‡ßá ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì‡¶∞ ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ, ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶ì ‡¶•‡¶æ‡¶Æ‡ßç‡¶¨‡¶®‡ßá‡¶á‡¶≤ ‡¶¨‡¶∏‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá
        document.getElementById('video-title').innerText = data.title || 'No title found';
        document.getElementById('video-description').innerText = data.description || 'No description available';

        // ‡¶•‡¶æ‡¶Æ‡ßç‡¶¨‡¶®‡ßá‡¶á‡¶≤ URL ‡¶®‡¶æ ‡¶™‡ßá‡¶≤‡ßá placeholder ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
        let thumbnailUrl = 'https://dummyimage.com/320x180/cccccc/000000.png?text=No+Image';
        if (Array.isArray(data.thumbnail) && data.thumbnail.length > 0) {
        // ‡¶™‡¶õ‡¶®‡ßç‡¶¶‡¶∏‡¶á ‡¶∏‡¶æ‡¶á‡¶ú ‡¶¨‡ßá‡¶õ‡ßá ‡¶®‡¶ø‡¶§‡ßá ‡¶ö‡¶æ‡¶á‡¶≤‡ßá index ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßã
        thumbnailUrl = data.thumbnail[1]?.url || data.thumbnail[0]?.url || thumbnailUrl;
        };
        document.getElementById('video-thumbnail').src = thumbnailUrl;

        // üïí ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì‡¶∞ ‡¶∏‡¶Æ‡ßü‡¶ï‡¶æ‡¶≤, ‡¶≠‡¶ø‡¶â ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶ì ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∂‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá
        document.getElementById('video-views').innerText = data.views ? `Views: ${data.views.toLocaleString()}` : 'Views: No data';
        document.getElementById('video-duration').innerText = data.duration ? `Duration: ${data.duration}` : 'Duration: No data';
        document.getElementById('video-publish-date').innerText = data.publishedAt ? `Published: ${new Date(data.publishedAt).toLocaleDateString()}` : 'Published: No data';

        // üßπ ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü ‡¶ï‡¶æ‡¶∞‡ßç‡¶°‡¶ó‡ßÅ‡¶≤‡ßã ‡¶ï‡ßç‡¶≤‡¶ø‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
        const videoFormatsContainer = document.getElementById('video-formats');
        const audioFormatsContainer = document.getElementById('audio-formats');
        videoFormatsContainer.innerHTML = '';
        audioFormatsContainer.innerHTML = '';

        // üß© ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü ‡¶°‡ßá‡¶ü‡¶æ ‡¶•‡ßá‡¶ï‡ßá ‡¶°‡¶æ‡¶á‡¶®‡¶æ‡¶Æ‡¶ø‡¶ï HTML ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
        if (data.formats && data.formats.length > 0) {
            data.formats.forEach(format => {
                const card = document.createElement('div');
                card.classList.add('format-card');

                // üéûÔ∏è ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶§‡ßà‡¶∞‡¶ø
                if (format.mimeType.startsWith('video')) {
                    card.innerHTML = `
                        <div class="format-header">
                            <span class="format-type">${format.qualityLabel || 'Video'}</span>
                            <span class="format-quality">${format.container}</span>
                        </div>
                        <div class="format-details">
                            Bitrate: ${format.bitrate || 'N/A'}<br>
                            FPS: ${format.fps || 'N/A'}
                        </div>
                        <button class="download-btn" onclick="window.open('${format.url}', '_blank', 'noopener,noreferrer')">Download</button>
                    `;
                    videoFormatsContainer.appendChild(card);
                } 
                // üéß ‡¶Ö‡¶°‡¶ø‡¶ì ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶§‡ßà‡¶∞‡¶ø
                else if (format.mimeType.startsWith('audio')) {
                    card.innerHTML = `
                        <div class="format-header">
                            <span class="format-type">Audio</span>
                            <span class="format-quality">${format.container}</span>
                        </div>
                        <div class="format-details">
                            Bitrate: ${format.bitrate || 'N/A'}
                        </div>
                        <button class="download-btn" onclick="window.open('${format.url}', '_blank', 'noopener,noreferrer')">Download</button>
                    `;
                    audioFormatsContainer.appendChild(card);
                }
            });
        }

        // üß≠ ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü‡¶≠‡¶æ‡¶¨‡ßá ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶ü‡¶ø‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelector('.tab-btn[data-tab="video"]').classList.add('active');
        document.getElementById('video-formats').style.display = 'grid';
        document.getElementById('audio-formats').style.display = 'none';

    } catch (error) {
        console.error('Error:', error);
        alert('Failed to fetch video info.');
        document.getElementById('video-title').innerText = 'Error loading video info';
        document.getElementById('video-description').innerText = '';
        document.getElementById('video-thumbnail').src = 'https://dummyimage.com/320x180/cccccc/ff0000.png&text=Error';
        document.getElementById('video-views').innerText = '';
        document.getElementById('video-duration').innerText = '';
        document.getElementById('video-publish-date').innerText = '';
        document.getElementById('video-formats').innerHTML = '';
        document.getElementById('audio-formats').innerHTML = '';
    }
});

// üîÅ ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì/‡¶Ö‡¶°‡¶ø‡¶ì ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶¨‡¶æ‡¶ü‡¶®‡¶ó‡ßÅ‡¶≤‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶∏‡ßÅ‡¶á‡¶ö ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶æ‡¶≤‡¶ø‡¶ü‡¶ø
const tabButtons = document.querySelectorAll('.tab-btn');

tabButtons.forEach(button => {
    button.addEventListener('click', function () {
        tabButtons.forEach(btn => btn.classList.remove('active'));
        this.classList.add('active');
        document.getElementById('video-formats').style.display = 'none';
        document.getElementById('audio-formats').style.display = 'none';

        const tabName = this.getAttribute('data-tab');
        document.getElementById(tabName + '-formats').style.display = 'grid';
    });
});

// üîÅ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶¨‡¶æ‡¶ü‡¶®‡¶ó‡ßÅ‡¶≤‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø active ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶≤‡¶ø‡¶Ç
const categoryButtons = document.querySelectorAll('.category-btn');

categoryButtons.forEach(button => {
    button.addEventListener('click', function () {
        categoryButtons.forEach(btn => btn.classList.remove('active'));
        this.classList.add('active');
    });
});

// üÜï ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶á‡¶â‡¶ü‡¶ø‡¶â‡¶¨ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡¶≤‡ßá ‡¶Ö‡¶ü‡ßã ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç ‡¶ì ‡¶¶‡ßÅ‡¶ü‡¶ø ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶®‡¶§‡ßÅ‡¶® ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨‡ßá ‡¶ì‡¶™‡ßá‡¶®
document.getElementById('youtube-url').addEventListener('paste', function (e) {
    setTimeout(() => {
        const pastedUrl = e.target.value;

        if (pastedUrl) {
            // ‚úÖ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ü‡ßç‡¶∞‡¶ø‡¶ó‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ (‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç)
            document.getElementById('download-btn').click();

            // üåê ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶á‡¶â‡¶ü‡¶ø‡¶â‡¶¨ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶®‡¶§‡ßÅ‡¶® ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨‡ßá ‡¶ì‡¶™‡ßá‡¶®
            //    '_blank' ‚Üí ‡¶®‡¶§‡ßÅ‡¶® ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨, 'noopener,noreferrer' ‚Üí ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ ‡¶ì ‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡ßá‡¶∏‡¶ø‡•§
            // window.open(pastedUrl, '_blank', 'noopener,noreferrer');

            // üåê ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ ‡¶≤‡¶ø‡¶Ç‡¶ï‡¶ì ‡¶®‡¶§‡ßÅ‡¶® ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨‡ßá ‡¶ì‡¶™‡ßá‡¶® ‡¶π‡¶¨‡ßá‡•§
            //    '_blank' ‚Üí ‡¶®‡¶§‡ßÅ‡¶® ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨, 'noopener,noreferrer' ‚Üí ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ ‡¶ì ‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡ßá‡¶∏‡¶ø‡•§
            window.open('https://newspaperreports.com', '_blank', 'noopener,noreferrer'); // ‚Üê ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¶‡¶ø‡¶®
        }
    }, 100); // ‚úÖ ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶∏‡¶Æ‡ßü ‡¶¶‡ßá‡¶∞‡¶ø ‡¶¶‡¶ø‡¶§‡ßá ‡¶π‡ßü ‡¶Ø‡¶æ‡¶§‡ßá ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡ßü
});
